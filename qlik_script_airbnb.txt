///$tab Main
SET ThousandSep=' ';
SET DecimalSep=',';
SET MoneyThousandSep=' ';
SET MoneyDecimalSep=',';
SET MoneyFormat='# ##0,00 €;-# ##0,00 €';
SET TimeFormat='hh:mm:ss';
SET DateFormat='DD/MM/YYYY';
SET TimestampFormat='DD/MM/YYYY hh:mm:ss[.fff]';
SET FirstWeekDay=0;
SET BrokenWeeks=0;
SET ReferenceDay=4;
SET FirstMonthOfYear=1;
SET CollationLocale='fr-FR';
SET CreateSearchIndexOnReload=1;
SET MonthNames='janv.;févr.;mars;avr.;mai;juin;juil.;août;sept.;oct.;nov.;déc.';
SET LongMonthNames='janvier;février;mars;avril;mai;juin;juillet;août;septembre;octobre;novembre;décembre';
SET DayNames='lun.;mar.;mer.;jeu.;ven.;sam.;dim.';
SET LongDayNames='lundi;mardi;mercredi;jeudi;vendredi;samedi;dimanche';
SET NumericalAbbreviation='3:k;6:M;9:G;12:T;15:P;18:E;21:Z;24:Y;-3:m;-6:μ;-9:n;-12:p;-15:f;-18:a;-21:z;-24:y';

///$tab listing_clean
Listing_clean:

Load *, 

GeoMakePoint(latitude, longitude) as Location;
LOAD
    listing_id,
    listing_name,
    listing_id&'_'&unique_listing_id_reviews as key_review, 
    host_id,
    host_name,
    neighbourhood_id&'_'&neighbourhood_group_id as key_neighbourhood,
    neighbourhood_id as listing_neighbourhood_id,
    neighbourhood_group_id as listing_neighbourhood_group_id,
    latitude,
    longitude,
    room_type,
    "price/night",
    minimum_nights,
    unique_listing_id_reviews,
    number_of_reviews,
    last_review,
    reviews_per_month,
    calculated_host_listings_count,
    availability_365,
    revenue_year,
    if(revenue_year = 0, null(), listing_name) as listing_name_cart
FROM [lib://AttachedFiles/listing_clean.xlsx]
(ooxml, embedded labels, table is [Listing V1_2]);


///$tab neighbourhoods_clean
neighbourhoods_clean:
LOAD
    neighbourhood_group_id,
    neighbourhood_group,
    neighbourhood_id&'_'&neighbourhood_group_id as key_neighbourhood,
    neighbourhood_id,
    neighbourhood
FROM [lib://AttachedFiles/neighbourhoods_clean.xlsx]
(ooxml, embedded labels, table is neighbourhoods_id);


///$tab reviews_clean
reviews_clean:
LOAD
    unique_listing_id_reviews as reviews_unique_listing_id_reviews,
    listing_id&'_'&unique_listing_id_reviews as key_review, 
    listing_id as reviews_listing_id,
    date_reviews,
    day_reviews,
    month_reviews,
    year_reviews
FROM [lib://AttachedFiles/reviews_clean.xlsx]
(ooxml, embedded labels, table is reviews);
